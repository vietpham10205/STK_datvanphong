-- Tạo bảng  STKdatvanphong
CREATE TABLE USERS (
    user_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR2(50) UNIQUE NOT NULL,
    password VARCHAR2(100) NOT NULL,
    full_name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    phone_number VARCHAR2(15),
    role VARCHAR2(20) CHECK (role IN ('Quản lý', 'Admin', 'Người cho thuê', 'Người thuê')) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ROOM_TYPES (
    room_type_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    type_name VARCHAR2(50) UNIQUE NOT NULL,
    description VARCHAR2(200)
);

CREATE TABLE LOCATIONS (
    location_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    location_name VARCHAR2(100) UNIQUE NOT NULL,
    address VARCHAR2(200) NOT NULL
);

CREATE TABLE ROOMS (
    room_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    room_name VARCHAR2(100) NOT NULL,
    room_type_id NUMBER REFERENCES ROOM_TYPES(room_type_id) ON DELETE CASCADE,
    location_id NUMBER REFERENCES LOCATIONS(location_id) ON DELETE CASCADE,
    area NUMBER NOT NULL,
    price_per_night NUMBER NOT NULL,
    capacity NUMBER NOT NULL,
    description VARCHAR2(500)
);

CREATE TABLE PACKAGES (
    package_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    package_name VARCHAR2(100) NOT NULL,
    price NUMBER NOT NULL,
    duration_days NUMBER NOT NULL
);

CREATE TABLE POSTS (
    post_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER REFERENCES USERS(user_id) ON DELETE CASCADE,
    room_id NUMBER REFERENCES ROOMS(room_id) ON DELETE CASCADE,
    package_id NUMBER REFERENCES PACKAGES(package_id) ON DELETE CASCADE,
    title VARCHAR2(150) NOT NULL,
    content VARCHAR2(2000) NOT NULL,
    status VARCHAR2(20) CHECK (status IN ('pending', 'approved', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE BOOKINGS (
    booking_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER REFERENCES USERS(user_id) ON DELETE CASCADE,
    room_id NUMBER REFERENCES ROOMS(room_id) ON DELETE CASCADE,
    check_in_date DATE NOT NULL,
    check_out_date DATE NOT NULL,
    total_price NUMBER NOT NULL,
    guest_count NUMBER NOT NULL,
    booking_status VARCHAR2(20) CHECK (booking_status IN ('pending', 'confirmed', 'cancelled')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE REVIEWS (
    review_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER REFERENCES USERS(user_id) ON DELETE CASCADE,
    room_id NUMBER REFERENCES ROOMS(room_id) ON DELETE CASCADE,
    rating NUMBER CHECK (rating BETWEEN 1 AND 5) NOT NULL,
    comment VARCHAR2(1000),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE SEARCH_HISTORY (
    search_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER REFERENCES USERS(user_id) ON DELETE CASCADE,
    search_content VARCHAR2(500) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);



----------